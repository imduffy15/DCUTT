var storage=window.localStorage,dcuTimetablesApp=angular.module("dcuTimetablesApp",[]).config(["$routeProvider","$locationProvider",function(a,b){b.html5Mode(!1),b.hashPrefix("!"),a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/settings",{templateUrl:"views/settings.html",controller:"SettingsCtrl"}).when("/credits",{templateUrl:"views/credits.html"}).when("/error",{templateUrl:"views/settings.html",controller:"ErrorCtrl"}).when("/:coursecode",{templateUrl:"views/timetable.html",controller:"TimetableCtrl"}).otherwise({redirectTo:"/"})}]);dcuTimetablesApp.controller("MainCtrl",["$location","$routeParams","$scope",function(a,b,c){var d=storage.getItem("coursecode")||!1;d&&a.path(d),c.getTimetable=function(){typeof c.coursecode!="undefined"&&(storage.setItem("coursecode",c.coursecode),a.path(c.coursecode))}}]),dcuTimetablesApp.controller("TimetableCtrl",["$scope","$location","$routeParams","$http",function(a,b,c,d){a.showLoader=!0,a.date=moment().format("YYYY-MM-DD");var e={},f=storage.getItem("timetable-cached"),g=new iScroll("wrapper",{hScrollbar:!1,vScrollbar:!0,bounce:!1,fadeScrollbar:!0}),h="://api.dcutt.com/index.php?callback=JSON_CALLBACK&coursecode=",i=function(){a.day=e[a.date],a.dayDate=moment(a.date,"YYYY-MM-DD").format("DD-MM-YYYY"),a.dayName=moment(a.date,"YYYY-MM-DD").format("dddd"),setTimeout(l,300)};a.updateEvents=i;var j=function(){a.date=moment(a.date,"YYYY-MM-DD").add("d",1).format("YYYY-MM-DD"),i()};a.nextDay=j;var k=function(){a.date=moment(a.date,"YYYY-MM-DD").subtract("d",1).format("YYYY-MM-DD"),i()};a.prevDay=k;var l=function(){g.refresh()};f&&(e=JSON.parse(storage.getItem("timetable")),i(),a.showLoader=!1),window.location.protocol=="https:"?h="https"+h:h="http"+h,Math.round((new Date).getTime()/1e3)-f>86400&&d.jsonp(h+c.coursecode,{timeout:500}).success(function(b){storage.setItem("timetable",JSON.stringify(b)),storage.setItem("timetable-cached",Math.round((new Date).getTime()/1e3)),e=b,i(),a.showLoader=!1}).error(function(a){f||(alert("Error processing your request!"),b.path("settings"))})}]),dcuTimetablesApp.controller("SettingsCtrl",["$location",function(a){storage.clear(),a.path("")}]),dcuTimetablesApp.directive("timetable",function(){return function(a,b,c){var d=function(){a.nextDay(),a.$apply()},e=function(){a.prevDay(),a.$apply()};$("body").swipeLeft(function(){d()}),$("body").swipeRight(function(){e()}),$(document).keydown(function(a){a.keyCode==39?d():a.keyCode==37&&e()})}}),dcuTimetablesApp.controller("ErrorCtrl",["$location","$routeParams","$scope",function(a,b,c){alert("Error processing your request!"),storage.clear(),a.path("")}]);