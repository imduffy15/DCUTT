document.addEventListener("touchmove",function(a){a.preventDefault()},!1);var storage=window.localStorage,dcuTimetablesApp=angular.module("dcuTimetablesApp",[]).config(["$routeProvider","$locationProvider",function(a,b){b.html5Mode(!1),b.hashPrefix("!"),a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/settings",{templateUrl:"views/settings.html",controller:"SettingsCtrl"}).when("/credits",{templateUrl:"views/credits.html"}).when("/error",{templateUrl:"views/error.html"}).when("/:coursecode",{templateUrl:"views/timetable.html",controller:"TimetableCtrl"}).otherwise({redirectTo:"/"})}]);dcuTimetablesApp.controller("MainCtrl",["$location","$routeParams","$scope",function(a,b,c){var d=storage.getItem("coursecode")||!1;d&&a.path(d),c.getTimetable=function(){c.coursecode!==null&&(storage.setItem("coursecode",c.coursecode),a.path(c.coursecode))}}]),dcuTimetablesApp.controller("TimetableCtrl",["$scope","$location","$routeParams","$http",function(a,b,c,d){a.showLoader=!0,a.date=moment().format("YYYY-MM-DD");var e={},f=storage.getItem("timetable-cached"),g=function(){a.day=e[a.date],a.dayDate=moment(a.date,"YYYY-MM-DD").format("DD-MM-YYYY"),a.dayName=moment(a.date,"YYYY-MM-DD").format("dddd")};a.updateEvents=g;var h=function(){a.date=moment(a.date,"YYYY-MM-DD").add("d",1).format("YYYY-MM-DD"),g()};a.nextDay=h;var i=function(){a.date=moment(a.date,"YYYY-MM-DD").subtract("d",1).format("YYYY-MM-DD"),g()};a.prevDay=i,Math.round((new Date).getTime()/1e3)-f<86400?(e=JSON.parse(storage.getItem("timetable")),g(),a.showLoader=!1):d({method:"JSONP",url:"http://api.dcutt.com/index.php?callback=JSON_CALLBACK&coursecode="+c.coursecode}).success(function(b){storage.setItem("timetable",JSON.stringify(b)),storage.setItem("timetable-cached",Math.round((new Date).getTime()/1e3)),e=b,g(),a.showLoader=!1}).error(function(a){b.path("error")})}]),dcuTimetablesApp.controller("SettingsCtrl",["$location",function(a){storage.clear(),a.path("")}]),dcuTimetablesApp.directive("timetable",function(){return function(a,b,c){var d=new iScroll("wrapper",{hScrollbar:!1,vScrollbar:!0,bounce:!1,fadeScrollbar:!0}),e=function(){d.refresh()};window.addEventListener("orientationchange",function(){setTimeout(e,500)},!1);var f=function(){a.nextDay(),a.$apply(),d.refresh()},g=function(){a.prevDay(),a.$apply(),d.refresh()};$("body").swipeLeft(function(){f()}),$("body").swipeRight(function(){g()}),$(document).keydown(function(a){a.keyCode==39?f():a.keyCode==37&&g()})}});